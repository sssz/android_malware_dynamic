import os
import sys
import copy
import time
import json

from androguard.core.bytecodes import apk
from dynamic.droidmon.droidmon_analysis import get_droidmon_apis
#     dynamic.droidmon.droidmon_analysis.py
from static.tools.string_parser import STRING_PARSER

def dynamic_analysis_one(file_path, result):
    start_time = time.time()

    app = apk.APK(file_path)
    droidmon_log = os.path.join(file_path + "_info", "x_logcat.txt")
    apis = get_droidmon_apis(droidmon_log, app.get_package())
    '''
        permission + intent_action + command + content urls + api
        permissions = permission_from_string + permission_from_api
        intent_action = intent_action_from_string
        command = intent_action_from_string
        content urls = from_string
        api = api
    '''
    
    for item in apis:
        result.append(item.to_save_format())

    time_cost = time.time() - start_time
    return time_cost


def dynamic_analysis():
    test_path = r'M:\Android_Samples\android_malware\Android_malware\drebin-data\drebin-0\4f77e4612dd548f6f60eb4db80393e1e019d6c2e593b92ac1829d928739217b4'
    result = []
    dynamic_analysis_one(test_path, result)
    print(json.dumps(result))


if __name__ == '__main__':
    dynamic_analysis()    