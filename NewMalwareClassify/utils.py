import os
import json
from random import shuffle
import traceback

from static.tools.api_parser import API_PARSER 
from static.tools.string_parser import STRING_PARSER


#direct_root 是apk文件所在的直接文件夹
def yield_app_paths(direct_root):
    cnt = 1
    for app in os.listdir(direct_root):
        app_abs_path = os.path.join(direct_root, app)
        if (not (app.endswith(".json") or app.endswith(".txt") or app.endswith(".tar"))) and os.path.isfile(app_abs_path):
            print("app idx: ", cnt, "app_path: ", app_abs_path)
            #计数api在app中的出现次数，一个api在一个app中出现多次，累加多次
            yield app
            cnt += 1


#root 是apk文件所在的文件夹, 文件夹下的子文件夹才有apk
def yield_app_paths2(root):
    cnt = 1
    for sub_root, dirs, apps in os.walk(root):
        for app in apps:
            app_abs_path = os.path.join(sub_root, app)
            if "API-Intent-Traffic" in sub_root:
                continue
            if (not (app.endswith(".json") or app.endswith(".txt") or app.endswith(".tar") or app.endswith(".zip") or app.endswith(".csv"))) and os.path.isfile(app_abs_path):
                print("app idx: ", cnt, "app_path: ", app_abs_path)
                yield sub_root, app
                cnt += 1




if __name__ == '__main__':
    #path = "M:\\Android_Samples\\android_malware\\Android_benign\\360shoujizhushou\\2017-12-03--2017-12-05\\1bba6a0486ae43e92992ce96191a6ae9059935a5.apk_info\\static.json"
    #data = json.load(open(path))
    #print(feature_vectorization_1(data))
    vectorization_main()