#encoding='UTF-8'

from androguard.core.bytecodes import apk, dvm
from androguard.core.analysis import analysis
import re
import os
import json
from static.extractor.base_extractor import baseInsExtractor
#from base_extractor import baseInsExtractor
from tools.string_parser import STRING_PARSER


class extractString(baseInsExtractor):
    def start_app(self, app, app_dex, app_x):
        super().start_app(app, app_dex, app_x)
        #self.parser = string_parser()

    def process_instruction(self, ins):
        try:
            if ins.get_name() == "const-string":
                value = ins.get_operands()[-1][-1][1:-1]
                if value not in self.result:
                    self.result[value] = 1
                else:
                    self.result[value] += 1
        except Exception as e:
            pass

    def finish_app(self, app, app_dex, app_x):
        self.result = STRING_PARSER.parse_strings(self.result)
        


if __name__ == "__main__":
    pass